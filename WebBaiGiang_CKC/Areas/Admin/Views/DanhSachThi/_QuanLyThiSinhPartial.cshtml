@model IEnumerable<WebBaiGiang_CKC.Models.ViewModels.HocVienThiCheckboxVM>
@{
    var kyId = ViewBag.KyKiemTraId;
}

<form id="formCapNhatDanhSachThi">
    <input type="hidden" id="KyKiemTraId" value="@kyId" />

    <div style="max-height:400px; overflow:auto;">
        <table class="table table-bordered table-sm align-middle">
            <thead class="table-light text-center">
                <tr>
                    <th><input type="checkbox" id="checkAllHV" /></th>
                    <th>Họ tên</th>
                    <th>Email</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var hv in Model)
                {
                    <tr>
                        <td class="text-center">
                            <input class="form-check-input chkHocVien" type="checkbox"
                                   value="@hv.MaHocVien" @(hv.DaTrongDanhSach ? "checked" : "") />
                        </td>
                        <td>@hv.HoTen</td>
                        <td>@hv.Email</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="text-end mt-3">
        <button type="button" id="btnLuuThiSinh" class="btn btn-primary">
            Lưu
        </button>
    </div>
</form>

<script>
    $("#checkAllHV").on("change", function () {
        $(".chkHocVien").prop("checked", this.checked);
    });

    $("#btnLuuThiSinh").click(function () {
        var ids = $(".chkHocVien:checked").map(function () { return parseInt(this.value); }).get();
        var req = { kyKiemTraId: parseInt($("#KyKiemTraId").val()), maHocViens: ids };

        $.ajax({
            url: '/Admin/DanhSachThi/CapNhatDanhSachThi',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(req),
            success: function (res) {
                if (res.success) {
                    notyf.success(res.message);
                    setTimeout(() => location.reload(), 1000);
                } else {
                    notyf.error(res.message);
                }
            },
            error: function () {
                notyf.error("Có lỗi xảy ra khi lưu!");
            }
        });
    });
</script>