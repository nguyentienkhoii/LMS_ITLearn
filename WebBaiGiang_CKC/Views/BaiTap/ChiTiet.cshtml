@model WebBaiGiang_CKC.Models.BaiTap
@{
    ViewData["Title"] = "Chi tiết bài tập";
}

<main>
    <div class="menu-toggle">
        <a href="#">Menu</a>
    </div>

    <div class="wrapper">
        @await Html.PartialAsync("_SidebarMenu")

        <div class="noidung">
            <h2 class="lesson-title">@Model.TenBaiTap</h2>
            <hr />

            <div class="lesson-desc">
                @Html.Raw(Model.MoTa)
            </div>

            <!-- 📎 Tệp bài tập đính kèm (dạng đẹp có icon nền) -->
            @if (!string.IsNullOrEmpty(Model.FileDinhKem))
            {
                var filePath = Url.Content(Model.FileDinhKem);
                var fileName = System.IO.Path.GetFileNameWithoutExtension(Model.FileDinhKem);
                var extension = System.IO.Path.GetExtension(Model.FileDinhKem).ToLower();

                string iconClass = "fa-solid fa-file";
                string iconColor = "#6b7280";
                string bgColor = "#f3f4f6";

                switch (extension)
                {
                    case ".pdf":
                        iconClass = "fa-solid fa-file-pdf"; iconColor = "#e11d48"; bgColor = "#fee2e2"; break;
                    case ".doc":
                    case ".docx":
                        iconClass = "fa-solid fa-file-word"; iconColor = "#2563eb"; bgColor = "#dbeafe"; break;
                    case ".ppt":
                    case ".pptx":
                        iconClass = "fa-solid fa-file-powerpoint"; iconColor = "#f97316"; bgColor = "#ffedd5"; break;
                    case ".xls":
                    case ".xlsx":
                        iconClass = "fa-solid fa-file-excel"; iconColor = "#059669"; bgColor = "#d1fae5"; break;
                    case ".zip":
                    case ".rar":
                        iconClass = "fa-solid fa-file-archive"; iconColor = "#6b7280"; bgColor = "#e5e7eb"; break;
                }

                <div class="modern-files">
                    <h4><i class="fa-solid fa-paperclip text-primary me-2"></i> Tệp bài tập đính kèm</h4>
                    <div class="file-list">
                        <a href="@filePath" target="_blank" class="file-info text-decoration-none d-flex align-items-center gap-2">
                            <div class="file-icon-circle" style="background:@bgColor;">
                                <i class="@iconClass" style="color:@iconColor;"></i>
                            </div>
                            <span>@fileName</span>
                        </a>
                    </div>
                </div>
            }

            <!-- 📄 Trạng thái bài nộp -->
            <div class="lesson-toc mt-4">
                <p class="toc-header">
                    <span>TRẠNG THÁI BÀI NỘP</span>
                </p>

                <div class="toc-content">
                    <table class="table table-bordered status-table">
                        <tr>
                            <th>Trạng thái bài nộp</th>
                            <td>@ViewBag.TrangThaiNop</td>
                        </tr>
                        <tr>
                            <th>Trạng thái chấm điểm</th>
                            <td>@Html.Raw(ViewBag.TrangThaiCham)</td>

                        </tr>
                        <tr>
                            <th>Hạn chót</th>
                            <td>@ViewBag.HanChot</td>
                        </tr>

                        @if (ViewBag.BaiTapNop != null)
                        {
                            var fileNop = (WebBaiGiang_CKC.Models.BaiTapNop)ViewBag.BaiTapNop;

                            <tr>
                                <th>Sửa đổi lần cuối</th>
                                <td>@fileNop.NgayNop?.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                            <tr>
                                <th>Lần nộp</th>
                                <td>@fileNop.LanNop</td>
                            </tr>
                            <tr>
                                <th>File đã nộp</th>
                                <td>
                                    <a href="@fileNop.FileNop" target="_blank" class="text-decoration-none filename-link">
                                        <i class="fa fa-paperclip text-primary me-1"></i>
                                        <span class="filename">@System.IO.Path.GetFileName(fileNop.FileNop)</span>
                                    </a>
                                </td>
                            </tr>
                        }
                        else
                        {
                            <tr><th>Ngày nộp</th><td>-</td></tr>
                            <tr><th>Lần nộp</th><td>-</td></tr>
                            <tr><th>File đã nộp</th><td>Chưa có bài nộp</td></tr>
                        }
                    </table>

                    <div class="text-center mt-3">
                        @if (ViewBag.BaiTapNop != null)
                        {
                            <a href="@Url.Action("NopBai", "BaiTap", new { baiTapId = Model.MaBaiTap })"
                               class="btn btn-warning px-4">
                                <i class="fa fa-edit me-2"></i> Sửa bài làm
                            </a>
                        }
                        else
                        {
                            <a href="@Url.Action("NopBai", "BaiTap", new { baiTapId = Model.MaBaiTap })"
                               class="btn btn-primary px-4">
                                <i class="fa fa-upload me-2"></i> Thêm bài làm
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <script src="~/assets/js/menu_.js"></script>
}

<style>
    .lesson-title { color: #1e3a8a; font-size: 1.8rem; font-weight: 700; margin-bottom: 0.5rem; }
    .lesson-desc { color: #374151; line-height: 1.6; margin-bottom: 1rem; }

    /* ====== Mục trạng thái ====== */
    .lesson-toc {
        background: #ffffff; border: 1px solid #e5e7eb; border-radius: 10px;
        padding: 1rem 1.5rem; margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .toc-header {
        font-weight: 600; color: #111827; font-size: 1rem;
        display: flex; justify-content: space-between; align-items: center;
    }

    /* ====== File đính kèm (đẹp như phần Bài) ====== */
    .modern-files {
        background: #fff; border: 1px solid #e5e7eb; border-radius: 12px;
        padding: 1rem 1.5rem; margin: 1.5rem 0;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .modern-files h4 {
        font-size: 1rem; font-weight: 600; color: #374151;
        margin-bottom: 1rem; display: flex; align-items: center; gap: 8px;
    }
    .file-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .file-info {
        background: #f9fafb; border-radius: 8px; color: #1f2937;
        transition: background 0.2s ease-in-out; padding: 0.5rem 0.75rem;
    }
    .file-info:hover { background: #e0f2fe; text-decoration: none; }
    .file-icon-circle {
        width: 36px; height: 36px; border-radius: 10px;
        display: flex; align-items: center; justify-content: center;
        transition: transform 0.2s ease;
    }
    .file-info:hover .file-icon-circle { transform: scale(1.1); }

    /* ====== Bảng trạng thái ====== */
    .status-table {
        width: 100%; border-collapse: collapse;
    }
    .status-table th {
        background-color: #f3f4f6; width: 25%;
        color: #111827; font-weight: 600; padding: 0.75rem;
        border: 1px solid #e5e7eb;
    }
    .status-table td {
        background-color: #fafafa; padding: 0.75rem;
        color: #374151; border: 1px solid #e5e7eb;
    }

    /* ====== File đã nộp giữ kiểu cũ ====== */
    .filename {
        font-size: 16px;
        color: #374151;
        word-break: break-all;
    }
    .filename-link:hover .filename {
        text-decoration: underline;
    }

    /* ====== Nút ====== */
    .btn-primary {
        background-color: #2563eb; border-color: #2563eb; border-radius: 8px;
    }
    .btn-primary:hover {
        background-color: #1e40af; border-color: #1e40af;
    }

    @@media (max-width: 768px) {
        .wrapper { flex-direction: column; }
        .noidung { width: 100%; }
    }
</style>
