<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Dashboard | LMS2025</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
    <meta content="Coderthemes" name="author">
    <!-- App favicon -->
    <!-- third party css -->
    <link href="~/AdminAssets/css/vendor/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css">
    <!-- third party css end -->

    <link href="~/AdminAssets/css/icons.min.css" rel="stylesheet" type="text/css">
    <link href="~/AdminAssets/css/app.min.css" rel="stylesheet" type="text/css" id="light-style">
    <link href="~/AdminAssets/css/app-dark.min.css" rel="stylesheet" type="text/css" id="dark-style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Tích hợp summernote và elfinder -->
    <link rel="stylesheet" href="~/lib/jquery-ui/themes/base/theme.css" />
    <link rel="stylesheet" href="~/lib/jquery-ui/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="~/lib/elfinder/css/elfinder.full.css" />
    <link rel="stylesheet" href="~/lib/elfinder/css/theme.css" />
    <link rel="stylesheet" href="~/css/elfinder/themes/material/css/theme-gray.css" />
    @*  summernote*@
    <link rel="stylesheet" href="~/lib/summernote/summernote-bs5.css" />
    <link rel="stylesheet" href="~/lib/summernote/summernote-lite.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://cdn.jsdelivr.net/npm/notyf@3.2.0/notyf.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/notyf@3.2.0/notyf.min.js"></script>

    @RenderSection("styles", required: false)
</head>

<body class="loading" data-layout-config='{"leftSideBarTheme":"dark","layoutBoxed":false, "leftSidebarCondensed":true, "leftSidebarScrollable":false,"darkMode":false, "showRightSidebarOnStart": true}'>
    <!-- Begin page -->
    <div class="wrapper">
        <!-- ========== Left Sidebar Start ========== -->
        <div class="leftside-menu">

            <!-- LOGO -->
            <a asp-area="GiangVien" asp-controller="Home" asp-action="Index" class="logo text-center logo-light">
                <span class="logo-lg">
                    <img src="~/AdminAssets/images/logoto.png" alt="" height="30">
                </span>
                <span class="logo-sm">
                    <img src="~/AdminAssets/images/logoto.png" alt="" height="16">
                </span>
            </a>

            <!-- LOGO -->
            <a asp-area="GiangVien" asp-controller="Home" asp-action="Index" class="logo text-center logo-dark">
                <span class="logo-lg">
                    <img src="~/AdminAssets/images/logoitlearn.png" alt="" height="30">
                </span>
                <span class="logo-sm">
                    <img src="~/AdminAssets/images/logoitlearn.png" alt="" height="16">
                </span>
            </a>


            <div class="h-100" id="leftside-menu-container" data-simplebar="">

                <!--- Sidemenu -->
                <ul class="side-nav">

                    <li class="side-nav-item">
                        <a asp-area="GiangVien" asp-controller="Home" asp-action="Index" class="side-nav-link">
                            <i class="uil-home-alt"></i>

                            <span> Trang chủ </span>
                        </a>

                    </li>

                    <li class="side-nav-item">
                        <a data-bs-toggle="collapse" href="#sidebarLopHoc" aria-expanded="false" aria-controls="sidebarLopHoc" class="side-nav-link">
                            <i class="uil-window"></i>
                            <span> QUẢN LÝ LỚP HỌC </span>
                            <span class="menu-arrow"></span>
                        </a>

                        <div class="collapse" id="sidebarLopHoc">
                            @await Component.InvokeAsync("LopHocGiangVien",
                                     new { maGiangVien = Convert.ToInt32(User.FindFirst("MaGiangVien")?.Value ?? "0") })

                        </div>
                    </li>
                </ul>

                <!-- End Sidebar -->

                <div class="clearfix"></div>

            </div>
            <!-- Sidebar -left -->

        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->
        @await Html.PartialAsync("~/Areas/GiangVien/Views/PartialView/_Header.cshtml")
        <div class="content-page">

            @RenderBody()
            <!-- content -->
            @await Html.PartialAsync("~/Areas/GiangVien/Views/PartialView/_Footer.cshtml")

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->


    </div>
    <!-- END wrapper -->
    <!-- Right Sidebar -->
    <div class="end-bar">

        <div class="rightbar-title">
            <a href="javascript:void(0);" class="end-bar-toggle float-end">
                <i class="dripicons-cross noti-icon"></i>
            </a>
            <h5 class="m-0">Settings</h5>
        </div>

        <div class="rightbar-content h-100" data-simplebar="">

            <div class="p-3">


                <!-- Settings -->
                <h5 class="mt-3">Color Scheme</h5>
                <hr class="mt-1">

                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="color-scheme-mode" value="light" id="light-mode-check" checked="">
                    <label class="form-check-label" for="light-mode-check">Light Mode</label>
                </div>

                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="color-scheme-mode" value="dark" id="dark-mode-check">
                    <label class="form-check-label" for="dark-mode-check">Dark Mode</label>
                </div>


                <!-- Width -->
                <h5 class="mt-4">Width</h5>
                <hr class="mt-1">
                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="width" value="fluid" id="fluid-check" checked="">
                    <label class="form-check-label" for="fluid-check">Fluid</label>
                </div>

                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="width" value="boxed" id="boxed-check">
                    <label class="form-check-label" for="boxed-check">Boxed</label>
                </div>


                <!-- Left Sidebar-->
                <h5 class="mt-4">Left Sidebar</h5>
                <hr class="mt-1">


                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="theme" value="light" id="light-check" checked="">
                    <label class="form-check-label" for="light-check">Light</label>
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" name="theme" value="dark" id="dark-check">
                    <label class="form-check-label" for="dark-check">Dark</label>
                </div>

                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="compact" value="fixed" id="fixed-check" checked="">
                    <label class="form-check-label" for="fixed-check">Fixed</label>
                </div>
                <hr class="mt-1">
                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="compact" value="condensed" id="condensed-check">
                    <label class="form-check-label" for="condensed-check">Condensed</label>
                </div>

                <div class="form-check form-switch mb-1">
                    <input class="form-check-input" type="checkbox" name="compact" value="scrollable" id="scrollable-check">
                    <label class="form-check-label" for="scrollable-check">Scrollable</label>
                </div>


            </div> <!-- end padding-->

        </div>
    </div>

    <div class="rightbar-overlay"></div>
    <!-- /End-bar -->
    <!-- bundle -->
    <script src="~/AdminAssets/js/vendor.min.js"></script>
    <script src="~/AdminAssets/js/app.min.js"></script>

    <!-- third party js -->

    <script src="~/AdminAssets/js/vendor/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="~/AdminAssets/js/vendor/jquery-jvectormap-world-mill-en.js"></script>
    <!-- third party js ends -->
    <!-- demo app -->
    @* <script src="~/AdminAssets/js/pages/demo.dashboard.js"></script>*@
    <!-- end demo js-->
    @*elfinder*@


    <environment names="Development">

        <script src="~/lib/jquery/dist/jquery.js"></script>
        @* <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>*@

    </environment>
    <environment names="Staging,Production">
        <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.7/bootstrap.min.js"
                asp-fallback-src="~/lib/bootstrap/dist/js/bootstrap.min.js"
                asp-fallback-test="window.jQuery && window.jQuery.fn && window.jQuery.fn.modal">
        </script>

    </environment>

    <script src="~/lib/jquery-ui/jquery-ui.min.js"></script>
    <script src="~/lib/elfinder/js/elfinder.full.js"></script>

    @* summernote*@

    <script src="~/lib/summernote/summernote-bs5.js"></script>
    <script src="~/lib/summernote/summernote-lite.min.js"></script>

    @await Component.InvokeAsync("Notyf")
    @RenderSection("scripts", required: false);


    <!-- ======= SignalR ========== -->
    @* <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script> *@
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script>
        window.conn = new signalR.HubConnectionBuilder()
            .withUrl("/hubs/notifications")
            .build();
        conn.on("ReceiveNotification", function (noti) {

            console.log("📌 NOTIFY:", noti);

            // 1️⃣ Chỉ +1 nếu là thông báo mới (isRead = false)
            if (noti.isRead === false) {
                let badge = document.getElementById("notiCount");
                if (badge) {
                    let current = parseInt(badge.innerText || "0");
                    badge.innerText = current + 1; 
                    badge.style.display = "inline-block";
                }
            }

            // 2️⃣ Popup
            new Notyf().success(noti.title + ": " + noti.message);

            // 3️⃣ Thêm vào dropdown
            let list = document.getElementById("notiList");
            if (list) {

                let cssClass = noti.isRead ? "read-noti" : "unread-noti";

                let html = `
                    <a href="${noti.url}"
                       class="dropdown-item notify-item noti-click ${cssClass}"
                       data-id="${noti.id}">
                        <div class="notify-icon bg-primary text-white">
                            <i class="fa fa-info-circle"></i>
                        </div>
                        <p class="notify-details mb-0">
                            <strong>${noti.title}</strong>
                            <span class="text-muted d-block">${noti.message}</span>
                            <small class="text-muted">${new Date(noti.createdAt).toLocaleString()}</small>
                        </p>
                    </a>
                `;

                list.insertAdjacentHTML("afterbegin", html);
            }
        });

        conn.start()
            .then(() => console.log("SignalR connected!"))
            .catch(err => console.error("SignalR error:", err));
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            $(document).on("click", ".noti-click", function () {

                let id = $(this).data("id");

                // Chỉ giảm nếu là thông báo chưa đọc
                if ($(this).hasClass("unread-noti")) {

                    let badge = document.getElementById("notiCount");
                    if (badge) {
                        let current = parseInt(badge.innerText || "0");
                        badge.innerText = current - 1;
                        if (current - 1 <= 0) badge.style.display = "none";
                    }
                }
                // Mark as read
                fetch('/GiangVien/Notification/MarkAsRead?id=' + id, { method: 'POST' });

                // Đổi UI trong dropdown
                $(this).removeClass("unread-noti").addClass("read-noti");
            });

        });

    </script>

    <style>
        .notify-item {
            pointer-events: auto !important;
        }
    </style>

</body>
</html>