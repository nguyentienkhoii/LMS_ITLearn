@{
    
}

<div class="content">
    <!-- 🔹 Topbar Start -->
    <div class="navbar-custom">
        <ul class="list-unstyled topbar-menu float-end mb-0">
            <!-- Mobile Search -->
            <li class="dropdown notification-list d-lg-none">
                <a class="nav-link dropdown-toggle arrow-none" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                    <i class="dripicons-search noti-icon"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-animated dropdown-lg p-0">
                    <form class="p-3">
                        <input type="text" class="form-control" placeholder="Search ..." aria-label="Recipient's username">
                    </form>
                </div>
            </li>

            <!-- Settings -->
            <li class="notification-list">
                <a class="nav-link end-bar-toggle" href="javascript:void(0);">
                    <i class="dripicons-gear noti-icon"></i>
                </a>
            </li>

            <!-- 🔹 User Dropdown -->
            <li class="dropdown notification-list">
                <a class="nav-link dropdown-toggle nav-user arrow-none me-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                    <span class="account-user-avatar">
                        <!-- ✅ Icon người thay cho ảnh -->
                        <div class="d-flex align-items-center justify-content-center bg-primary text-white rounded-circle"
                             style="width:36px;height:36px; line-height:36px;">
                            <i class="fa fa-user" style="font-size:16px;"></i>
                        </div>

                    </span>
                    <span>
                        <span class="account-user-name">@User.Identity.Name</span>
                    </span>
                </a>

                <!-- Dropdown Menu -->
                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animated topbar-dropdown-menu profile-dropdown">
                    <div class="dropdown-header noti-title">
                        <h6 class="text-overflow m-0">Xin chào!</h6>
                    </div>

                    <!-- Đổi mật khẩu -->
                    <a href="javascript:void(0);" class="dropdown-item notify-item" data-bs-toggle="modal" data-bs-target="#signup-modal">
                        <i class="mdi mdi-account-circle me-1"></i>
                        <span>Đổi mật khẩu</span>
                    </a>

                    <!-- Đăng xuất -->
                    <a class="dropdown-item notify-item" asp-controller="Account" asp-action="Logout" asp-area="">
                        <i class="mdi mdi-logout me-1"></i>
                        <span>Đăng xuất</span>
                    </a>
                </div>
            </li>
        </ul>

        <button class="button-menu-mobile open-left">
            <i class="mdi mdi-menu"></i>
        </button>
    </div>
</div>
<!-- 🔹 End Topbar -->
<!-- 🔹 Modal Đổi mật khẩu -->
<div id="signup-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Đổi mật khẩu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <div class="modal-body" ng-app="DoiMatKhauApp" ng-controller="doimatkhaujs">
                <div class="text-center mt-2 mb-4">
                    <a asp-controller="Home" asp-action="Index" class="text-success">
                        <span><img src="~/AdminAssets/images/icon1.png" alt="" height="36"></span>
                    </a>
                </div>
                <form class="ps-3 pe-3">
                    <div class="mb-3">
                        <label class="form-label">Mật khẩu cũ</label>
                        <input class="form-control" type="password" ng-model="currentPassword" required placeholder="Nhập mật khẩu cũ">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Mật khẩu mới</label>
                        <input class="form-control" type="password" ng-model="newPassword" required placeholder="Nhập mật khẩu mới">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Xác nhận mật khẩu</label>
                        <input class="form-control" type="password" ng-model="confirmPassword" required placeholder="Nhập lại mật khẩu mới">
                    </div>

                    <div class="mb-3 text-center">
                        <button class="btn btn-primary" type="submit" ng-click="doimatkhau(); showModal = false;" data-dismiss="modal">
                            <i class="fa fa-key"></i> Đổi mật khẩu
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- 🔹 AngularJS Script -->
<script>
    var app = angular.module('DoiMatKhauApp', []);

    app.controller('doimatkhaujs', function ($scope, $http, notyf) {
        $scope.showModal = true;

        $scope.doimatkhau = function () {
            var currentPassword = $scope.currentPassword;
            var newPassword = $scope.newPassword;
            var confirmPassword = $scope.confirmPassword;

            if (newPassword !== confirmPassword) {
                notyf.error('Mật khẩu mới và xác nhận không khớp.');
                return;
            }

            if (newPassword.length < 6) {
                notyf.error('Mật khẩu mới phải có ít nhất 6 ký tự.');
                return;
            }

            var data = {
                currentPassword: currentPassword,
                newPassword: newPassword,
                confirmPassword: confirmPassword
            };

            $http({
                method: 'POST',
                url: '/api/authentication/changepasswordgv',
                data: data,
                headers: { 'Content-Type': 'application/json' },
                withCredentials: true
            })
                .then(function (response) {
                    notyf.success(response.data);
                    $scope.currentPassword = '';
                    $scope.newPassword = '';
                    $scope.confirmPassword = '';
                    $('#signup-modal').modal('hide');
                })
                .catch(function (error) {
                    notyf.error(error.data || 'Đổi mật khẩu thất bại!');
                    console.log('Request error', error);
                });
        };
    });

    app.factory('notyf', function () {
        return new Notyf({
            duration: 3000,
            position: { x: 'right', y: 'top' },
            types: [
                {
                    type: 'success',
                    background: '#00b300',
                    icon: { className: 'material-icons', tagName: 'i', text: 'check_circle', color: 'white' },
                },
                {
                    type: 'error',
                    background: '#ff4d4d',
                    icon: { className: 'material-icons', tagName: 'i', text: 'cancel', color: 'white' },
                }
            ],
        });
    });
</script>
